<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=2560, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'" />
    <meta name="color-scheme" content="light dark" />
    <title>睑板腺热脉冲控制中心</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="view-home">
    <script>
      (function() {
        const params = new URLSearchParams(window.location.search || '');
        let debugWeb = params.has('debugWeb');
        const debugMouse = params.has('debugMouse') || debugWeb || location.protocol.startsWith('http');
        if (!window.api) {
          debugWeb = true; // fallback to stub when no electron preload
        }
        window.__PPHC_WEBDEBUG__ = debugWeb;
        if (debugWeb) {
          document.documentElement.classList.add('debug-web');
        }
        if (debugMouse) {
          document.documentElement.classList.add('debug-mouse');
        }
        if (!window.api) {
          const noop = () => {};
          window.api = {
            listPorts: async () => [],
            connect: async () => false,
            disconnect: async () => {},
            sendU8: noop,
            sendF32: noop,
            sendU16: noop,
            sendU32: noop,
            sendText: noop,
            exitApp: noop,
            getBrightness: async () => ({ percent: 80, raw: 0, max: 255 }),
            setBrightness: async () => ({ percent: 80, raw: 0, max: 255 }),
            getVolume: async () => ({ percent: 60 }),
            setVolume: async () => ({ percent: 60 }),
            getPlayChime: async () => ({ on: true }),
            setPlayChime: async () => ({ on: true }),
            getPressureAlertSound: async () => ({ on: true }),
            setPressureAlertSound: async () => ({ on: true }),
            getSettings: async () => ({
              language: 'zh',
              theme: 'dark',
              fontScale: 1,
              autoConnect: true,
              lastCalibrationAt: null,
            }),
            updateSettings: async (patch) => ({
              language: patch?.language || 'zh',
              theme: patch?.theme || 'dark',
              fontScale: patch?.fontScale || 1,
              autoConnect: patch?.autoConnect ?? true,
              lastCalibrationAt: patch?.lastCalibrationAt ?? null,
            }),
            getPatients: async () => [],
            addPatient: async (patient) => ({
              id: patient?.id || `P${String(Date.now()).slice(-4)}`,
              createdAt: new Date().toISOString(),
              updatedAt: new Date().toISOString(),
              ...patient,
            }),
            updatePatient: async (payload) => ({ id: payload?.id || 'P0001', ...(payload?.patch || {}) }),
            restorePatients: async () => ({ success: true, restored: [] }),
            listLogs: async () => [],
            readLog: async () => '',
            checkUpdates: async () => ({ currentVersion: '0.0.0', latestVersion: null, updateAvailable: false }),
            listPrinters: async () => [{ name: 'Default Printer', displayName: 'Default Printer', isDefault: true }],
            getPrinter: async () => ({ printerName: '' }),
            setPrinter: async (name) => ({ printerName: name }),
            printReport: async () => ({ success: true, failureReason: null }),
            exportReportPdf: async () => ({ success: true, filePath: 'reports/demo.pdf' }),
            exportReportData: async () => ({ success: true, filePath: 'reports/demo.doc' }),
            listReports: async () => ([{ name: 'demo_P0001.pdf', url: 'about:blank', mtimeMs: Date.now(), size: 0, patientId: 'P0001' }]),
            printReportPdf: async () => ({ success: true, failureReason: null }),
            shareReport: async () => ({ success: true, filePath: 'reports/share/demo.pdf' }),
            removePatient: async () => ({ success: true }),
            clearPatients: async () => ({ success: true }),
            removeReport: async () => ({ success: true }),
            clearReports: async () => ({ success: true }),
            login: async (username, password) => ({ ok: username === 'admin' && password === 'admin', role: 'admin', username }),
            listAccounts: async () => ([{ username: 'admin', role: 'admin' }]),
            addAccount: async (account) => ([{ username: 'admin', role: 'admin' }, { username: account.username, role: account.role || 'operator' }]),
            removeAccount: async () => ([{ username: 'admin', role: 'admin' }]),
            resetAccountPassword: async () => ([{ username: 'admin', role: 'admin' }]),
            logToMain: noop,
            onSerialData: () => {},
            onConnectionChanged: () => {},
            onHeartbeatAck: () => {},
            onSystemState: () => {},
            onAlarmState: () => {},
            onModeCurves: () => {},
            onStopTreatment: () => {},
            onShieldState: () => {},
          };
        }
      })();
    </script>
    <div id="loginOverlay" class="login-overlay active" aria-live="polite">
      <div class="login-panel">
        <div class="login-branding">
          <div class="brand-logo">
            <img src="../resoure/logo.png" alt="九辰医疗" />
            <div class="brand-text">
              <strong>九辰医疗</strong>
              <span>Pressure Pulse Host</span>
            </div>
          </div>
          <div class="brand-title">
            <h1>系统登录</h1>
            <p>请使用授权账号登录以进入控制界面</p>
          </div>
        </div>
        <form id="loginForm" autocomplete="off">
          <label class="login-field">
            <span>用户名</span>
            <input
              type="text"
              id="loginUser"
              class="login-input"
              inputmode="none"
              value="admin"
              autocomplete="off"
              spellcheck="false"
              data-osk-target="user"
            />
          </label>
          <label class="login-field">
            <span>密码</span>
            <input
              type="password"
              id="loginPass"
              class="login-input"
              inputmode="none"
              value="admin"
              autocomplete="off"
              spellcheck="false"
              data-osk-target="pass"
            />
          </label>
          <div class="login-error" id="loginError" hidden>
            <span class="login-error-icon">⚠</span>
            <span id="loginErrorText">账号或密码错误，请重试。</span>
          </div>
          <div class="login-actions">
            <button type="button" id="loginSubmit" class="action primary-toggle">登录</button>
          </div>
          <div class="login-extra">
            <button type="button" id="loginAddUser" class="ghost-btn">+ 新增用户</button>
            <button type="button" id="loginResetLink" class="ghost-btn link">忘记密码？重置</button>
          </div>
        </form>
      </div>
      <div id="loginToast" class="login-toast" hidden></div>
    </div>
    <div class="osk osk-hidden" id="osk" data-lang="zh">
      <div id="imeCandidates" class="ime-candidates osk-hidden"></div>
      <div class="osk-header">
        <div>
          <div class="osk-overline">屏幕键盘</div>
          <div class="osk-title">Screen Keyboard</div>
        </div>
        <div class="osk-lang">
          <button type="button" class="osk-lang-btn active" data-lang="zh">中文</button>
          <button type="button" class="osk-lang-btn" data-lang="en">English</button>
        </div>
      </div>
      <div class="osk-keys" id="oskKeys"></div>
    </div>
    <div class="bg-board"></div>
    <div class="app-shell" data-view="home">
      <div class="window-controls">
        <div id="userBadge" class="user-badge" hidden>
          <div class="avatar" id="userAvatar">--</div>
          <div class="meta">
            <div id="userName">--</div>
            <div id="userRole">--</div>
          </div>
        </div>
        <button id="btnExit" class="ghost exit-button">退出程序</button>
      </div>
      <section id="homeScreen" class="screen home-screen">
        <div class="hero-backdrop">
          <div class="hero-glow hero-glow-left"></div>
          <div class="hero-glow hero-glow-right"></div>
          <div class="hero-grid">
            <div class="hero-blade"></div>
            <div class="hero-content">
              <div class="hero-clock" id="heroClock">2025/09/16 15:30</div>
              <div class="hero-nameplate">
                <div class="hero-logo" aria-label="九辰医疗 9C-U-TPS">
                  <img src="../resoure/logo.png" alt="九辰医疗标志" />
                  <div class="hero-logo-text">
                    <strong>九辰医疗</strong>
                    <span>NINESTARS</span>
                  </div>
                </div>
                <div class="hero-codename">9C-U-TPS</div>
              </div>
              <div class="hero-text">
                <h1>眼板腺热脉动治疗仪</h1>
                <p class="hero-subtitle">Thermal Pulsation System</p>
                <p class="hero-desc">面向干眼诊疗的恒温恒压热脉动平台，融合九辰医疗 9C-U-TPS 研发经验与安全控制实力。</p>
              </div>
              <div class="hero-actions-home">
                <button id="btnHomeQuick" class="hero-btn primary">
                  <span class="label">开始治疗</span>
                  <small>Start Session</small>
                </button>
                <button id="btnHomeDevice" class="hero-btn secondary">
                  <span class="label">设备设置</span>
                  <small>Device Settings</small>
                </button>
                <button id="btnHomeNewPatient" class="hero-btn tertiary">
                  <span class="label">新建档案</span>
                  <small>Create Profile</small>
                </button>
                <button id="btnHomePatientList" class="hero-btn tertiary">
                  <span class="label">病例列表</span>
                  <small>Patient Files</small>
                </button>
              </div>
            </div>
            <div class="hero-eye-texture">
              <div class="hero-eye-core"></div>
              <div class="hero-eye-ring hero-eye-ring-outer"></div>
              <div class="hero-eye-ring hero-eye-ring-inner"></div>
              <div class="hero-eye-scan"></div>
            </div>
          </div>
        </div>
      </section>

      
      <section id="quickScreen" class="screen quick-screen">
        <div class="quick-container">
          <header class="top-bar">
            <button id="btnBackHome" class="icon-back" aria-label="返回主界面"><span>←</span></button>
            <div class="section-title"></div>
            <div class="top-placeholder"></div>
          </header>

          <div class="quick-grid">
            <div class="telemetry-area">
              <div class="quick-top-row">
                <div class="surface quick-patient-panel" id="quickPatientPicker">
                  <div class="panel-headline">
                    <div>
                      <div class="panel-overline" id="quickPatientTitle">患者选择</div>
                      <div class="panel-title" id="quickPatientSelected">--</div>
                    </div>
                  </div>
                  <div class="quick-patient-history" id="quickPatientHistory">--</div>
                  <div class="quick-patient-list" id="quickPatientList"></div>
                </div>

                <div class="surface summary-panel">
                  <div class="panel-headline">
                    <div>
                      <div class="panel-overline">实时读数</div>
                      <div class="panel-title">压力 / 温度</div>
                    </div>
                    <div class="live-chip">实时刷新</div>
                    <div class="live-chip stage-chip stage-idle" id="modeStageChip">
                      <span class="stage-eyebrow">当前阶段</span>
                      <div class="stage-main">
                        <span class="stage-orb"></span>
                        <span class="stage-label">待机</span>
                      </div>
                    </div>
                  </div>
                  <div class="circle-readings">
                    <div class="reading-circle" data-side="left">
                      <div class="ring"></div>
                      <div class="circle-core">
                      <div class="circle-label">左眼</div>
                      <div class="circle-value">
                          <span id="pressureLeft">0.0</span>
                          <small>mmHg</small>
                      </div>
                      <div class="circle-temp">
                        <span>温度</span>
                        <strong id="tempLeft">--.-℃</strong>
                      </div>
                      </div>
                    </div>
                    <div class="reading-circle" data-side="right">
                      <div class="ring"></div>
                      <div class="circle-core">
                      <div class="circle-label">右眼</div>
                      <div class="circle-value">
                          <span id="pressureRight">0.0</span>
                          <small>mmHg</small>
                      </div>
                      <div class="circle-temp">
                        <span>温度</span>
                        <strong id="tempRight">--.-℃</strong>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="surface curve-panel">
                <div class="panel-headline">
                  <div>
                    <div class="panel-overline">实时曲线</div>
                    <div class="panel-title">波形监控</div>
                  </div>
                  <div class="curve-tools">
                    <div class="curve-legend">
                      <span class="legend pressure-left">左眼压力</span>
                      <span class="legend pressure-right">右眼压力</span>
                      <span class="legend temp-left">左眼温度</span>
                      <span class="legend temp-right">右眼温度</span>
                    </div>
                    <div class="curve-actions">
                      <button id="btnCurveHistory" class="ghost-btn" type="button">历史治疗曲线</button>
                      <button id="btnCurveZoom" class="ghost-btn" type="button">缩放 1x</button>
                    </div>
                  </div>
                </div>
                <div class="curve-grid">
                  <div class="curve-card pressure">
                    <div class="curve-head">
                      <div>左眼压力</div>
                      <div id="pressureLeftLabel">0.0 mmHg</div>
                    </div>
                    <canvas id="sparkPressureLeft" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card pressure">
                    <div class="curve-head">
                      <div>右眼压力</div>
                      <div id="pressureRightLabel">0.0 mmHg</div>
                    </div>
                    <canvas id="sparkPressureRight" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card temp">
                    <div class="curve-head">
                      <div>左侧温度</div>
                      <div id="tempLeftLabel">--.-℃</div>
                    </div>
                    <canvas id="sparkTempLeft" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card temp">
                    <div class="curve-head">
                      <div>右侧温度</div>
                      <div id="tempRightLabel">--.-℃</div>
                    </div>
                    <canvas id="sparkTempRight" width="1024" height="260"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <div class="side-area">
              <div class="surface shield-panel">
                <div class="panel-title">眼盾状态</div>
                <div class="shield-grid">
                  <div class="shield-tile" id="shieldLeft">
                    <div class="tile-header">
                      <span class="eye-label">左眼</span>
                      <span class="chip state" id="shieldLeftState">未在线</span>
                    </div>
                    <div class="tile-body">
                      <div class="meta-row"><span>存在</span><strong id="shieldLeftPresent">--</strong></div>
                      <div class="meta-row"><span>熔断</span><strong id="shieldLeftFuse">--</strong></div>
                    </div>
                  </div>
                  <div class="shield-tile" id="shieldRight">
                    <div class="tile-header">
                      <span class="eye-label">右眼</span>
                      <span class="chip state" id="shieldRightState">未在线</span>
                    </div>
                    <div class="tile-body">
                      <div class="meta-row"><span>存在</span><strong id="shieldRightPresent">--</strong></div>
                      <div class="meta-row"><span>熔断</span><strong id="shieldRightFuse">--</strong></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="surface treatment-panel">
                <div class="panel-headline">
                  <div>
                    <div class="panel-overline">治疗参数</div>
                    <div class="panel-title"></div>
                  </div>
                </div>
              <div class="control-stack">
                <div class="slider-card" data-kind="pressure">
                    <div class="slider-head">
                      <div>
                        <div class="eyebrow">治疗压力</div>
                      </div>
                      <div class="slider-value" id="pressMmHgValue">250 mmHg</div>
                    </div>
                    <input type="range" id="pressMmHg" min="150" max="350" step="100" value="250" />
                    <div class="slider-scale">
                      <span>150</span>
                      <span>250</span>
                      <span>350</span>
                    </div>
                  </div>
                  <div class="slider-card" data-kind="duration">
                    <div class="slider-head">
                      <div>
                        <div class="eyebrow">治疗时长</div>
                      </div>
                      <div class="duration-values">
                        <span class="target-duration" id="durationValue">10 min</span>
                        <span class="countdown-chip" id="countdown">10:00</span>
                      </div>
                    </div>
                    <input type="range" id="treatDuration" min="1" max="15" step="1" value="10" />
                    <div class="slider-scale">
                      <span>1</span>
                      <span>5</span>
                      <span>10</span>
                      <span>15</span>
                    </div>
                  </div>
                </div>
                <div class="action-cluster">
                  <button id="btnManualSave" class="action subtle" type="button">保存进度</button>
                  <button id="btnStartStop" class="action primary-toggle" disabled>开始</button>
                </div>
                <div class="recommend-block">
                  <div class="recommend-title" id="recommendPlanTitle">推荐方案</div>
                  <div class="recommend-value" id="recommendPlanValue">--</div>
                </div>
              </div>

              <div class="surface info-panel">
                <div class="panel-title">系统状态</div>
                <div class="info-grid wide">
                  <div>
                    <div class="label">治疗状态</div>
                    <div id="runState" class="value-chip muted">待命</div>
                  </div>
                  <div>
                    <div class="label">告警</div>
                    <div id="alarmState" class="value-chip muted">--</div>
                  </div>
                  <div>
                    <div class="label">系统状态</div>
                    <div id="systemState" class="value-chip muted">--</div>
                  </div>
                  <div>
                    <div class="label">连接状态</div>
                    <div id="connectionState" class="value-chip muted">未连接</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="newPatientScreen" class="screen new-patient-screen">
        <div class="form-shell">
          <header class="top-bar">
            <button id="btnBackNewPatient" class="icon-back" aria-label="返回主页"><span>←</span></button>
            <div class="section-title">新建档案</div>
            <div class="top-placeholder"></div>
          </header>

          <form id="patientForm" class="patient-form">
            <div class="form-row">
              <label for="patientId" id="lblPatientId">患者编号</label>
              <input
                type="text"
                id="patientId"
                name="patientId"
                class="osk-input"
                data-osk-target="patient-id"
                data-osk-zone="patient"
                placeholder="P0001"
              />
            </div>
            <div id="patientIdHint" class="form-msg info" hidden></div>
            <div class="form-row">
              <label for="patientName" id="lblPatientName">姓名</label>
              <input
                type="text"
                id="patientName"
                name="patientName"
                placeholder="请输入姓名"
                class="osk-input"
                data-osk-target="patient-name"
                data-osk-zone="patient"
              />
            </div>
            <div class="form-row">
              <label id="lblPatientGender">性别</label>
              <div class="radio-group">
                <label><input type="radio" name="patientGender" value="男" checked /> 男</label>
                <label><input type="radio" name="patientGender" value="女" /> 女</label>
              </div>
            </div>
            <div class="form-row">
              <label for="patientPhone" id="lblPatientPhone">联系电话</label>
              <input
                type="tel"
                id="patientPhone"
                name="patientPhone"
                inputmode="tel"
                placeholder="11 位手机号"
                class="osk-input"
                data-osk-target="patient-phone"
                data-osk-zone="patient"
              />
            </div>
            <div class="form-row">
              <label for="patientTherapist" id="lblPatientTherapist">治疗师</label>
              <input
                type="text"
                id="patientTherapist"
                name="patientTherapist"
                placeholder="填写治疗师"
                class="osk-input"
                data-osk-target="patient-therapist"
                data-osk-zone="patient"
              />
            </div>
            <div class="form-row">
              <label for="patientDeviceModel" id="lblPatientDevice">设备型号</label>
              <input
                type="text"
                id="patientDeviceModel"
                name="patientDeviceModel"
                placeholder="设备型号"
                class="osk-input"
                data-osk-target="patient-device"
                data-osk-zone="patient"
              />
            </div>
            <div class="form-row">
              <label for="patientStatus" id="lblPatientStatus">病例状态</label>
              <select id="patientStatus">
                <option value="active">进行中</option>
                <option value="completed">已完成</option>
                <option value="archived">已归档</option>
              </select>
            </div>
            <div class="form-row">
              <label for="patientBirth" id="lblPatientBirth">出生日期</label>
              <input
                type="text"
                id="patientBirth"
                name="patientBirth"
                class="osk-input date-input"
                data-osk-target="patient-birth"
                data-osk-zone="patient"
                readonly
                placeholder="YYYY-MM-DD"
              />
            </div>
            <div class="form-row">
              <label for="patientNotes" id="lblPatientNotes">备注信息</label>
              <textarea
                id="patientNotes"
                name="patientNotes"
                rows="3"
                placeholder="记录症状、注意事项等"
                class="osk-input"
                data-osk-target="patient-notes"
                data-osk-zone="patient"
              ></textarea>
            </div>
            <div class="form-row">
              <label id="lblPatientPhoto">面部照片</label>
              <div class="photo-field">
                <img id="patientPhotoPreview" alt="患者照片预览" hidden />
                <button type="button" id="btnCapturePhoto" class="ghost-btn">拍照</button>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" id="btnGoPatientList" class="action subtle">查看列表</button>
              <button type="submit" id="btnSavePatient" class="action start">保存档案</button>
            </div>
            <div id="patientFormMessage" class="form-msg" hidden></div>
          </form>
          <div class="osk osk-hidden patient-osk" id="patientOsk" data-lang="zh">
            <div id="patientImeCandidates" class="ime-candidates osk-hidden"></div>
            <div class="osk-header">
              <div>
                <div class="osk-overline">屏幕键盘</div>
                <div class="osk-title">Screen Keyboard</div>
              </div>
              <div class="osk-lang">
                <button type="button" class="osk-lang-btn active" data-lang="zh">中文</button>
                <button type="button" class="osk-lang-btn" data-lang="en">English</button>
              </div>
            </div>
            <div class="osk-keys" id="patientOskKeys"></div>
          </div>
        </div>
      </section>

      <div id="datePickerModal" class="modal date-picker-modal" hidden>
        <div class="modal-body date-picker-body">
          <div class="date-picker-header">
            <button type="button" id="datePrevMonth" class="ghost-btn">←</button>
            <div id="datePickerTitle" class="date-picker-title">2025-01</div>
            <button type="button" id="dateNextMonth" class="ghost-btn">→</button>
          </div>
          <div id="datePickerYearPanel" class="date-picker-year-panel" hidden>
            <div id="datePickerYearTitle" class="date-picker-year-title">选择年份</div>
            <div id="datePickerYearList" class="date-picker-year-list"></div>
            <div class="date-picker-year-actions">
              <button type="button" id="datePickerBack" class="action subtle">返回</button>
            </div>
          </div>
          <div id="datePickerWeekdays" class="date-picker-weekdays"></div>
          <div id="datePickerGrid" class="date-picker-grid"></div>
          <div class="date-picker-actions">
            <button type="button" id="datePickerToday" class="action subtle">今天</button>
            <button type="button" id="datePickerCancel" class="action subtle">取消</button>
          </div>
        </div>
      </div>

      <section id="patientListScreen" class="screen patient-list-screen">
        <div class="form-shell">
          <header class="top-bar">
            <button id="btnBackPatientList" class="icon-back" aria-label="返回主页"><span>←</span></button>
            <div class="section-title">病例列表</div>
            <div class="top-actions">
              <button id="btnOpenReportArchive" class="ghost-btn" type="button">报告</button>
              <button id="btnBatchExport" class="ghost-btn" type="button">批量导出</button>
              <button id="btnDeletePatient" class="ghost-btn" type="button">删除</button>
              <button id="btnUndoPatientDelete" class="ghost-btn" type="button" disabled>撤销删除</button>
              <button id="btnClearPatients" class="ghost-btn" type="button">清空</button>
            </div>
          </header>

          <div class="patient-filters">
            <div class="filter-field">
              <label id="filterDateLabel">治疗日期</label>
              <input id="filterStartDate" class="osk-input date-input" type="text" placeholder="起始日期" readonly />
              <span class="filter-sep">至</span>
              <input id="filterEndDate" class="osk-input date-input" type="text" placeholder="结束日期" readonly />
            </div>
            <div class="filter-field">
              <label id="filterIdLabel">患者编号</label>
              <input id="filterPatientId" class="osk-input" type="text" placeholder="患者编号" />
            </div>
            <div class="filter-field">
              <label id="filterNameLabel">姓名</label>
              <input id="filterPatientName" class="osk-input" type="text" placeholder="姓名" />
            </div>
            <div class="filter-field">
              <label id="filterTherapistLabel">治疗师</label>
              <input id="filterTherapist" class="osk-input" type="text" placeholder="治疗师" />
            </div>
            <div class="filter-field">
              <label id="filterDeviceLabel">设备型号</label>
              <input id="filterDeviceModel" class="osk-input" type="text" placeholder="设备型号" />
            </div>
            <div class="filter-field">
              <label id="filterStatusLabel">病例状态</label>
              <select id="filterStatus">
                <option value="">全部</option>
                <option value="active">进行中</option>
                <option value="completed">已完成</option>
                <option value="archived">已归档</option>
              </select>
            </div>
            <button id="btnClearFilters" class="ghost-btn" type="button">重置筛选</button>
          </div>

          <div id="patientListEmpty" class="empty-tip" hidden>暂无病例，请先创建。</div>
          <div id="patientList" class="patient-list"></div>
        </div>
      </section>

      <section id="reportScreen" class="screen report-screen">
        <div class="report-shell">
          <header class="top-bar">
            <button id="btnBackReport" class="icon-back" aria-label="返回病例列表"><span>←</span></button>
            <div class="section-title" id="reportScreenTitle">打印报告</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="report-container">
            <div id="reportPage" class="report-page">
              <div class="report-header">
                <div class="report-title" id="reportHeaderTitle">Report</div>
                <div class="report-subline" id="reportGeneratedAt"></div>
              </div>

              <section class="report-section">
                <h3 id="reportPatientInfoTitle">患者信息</h3>
                <div class="report-grid" id="reportPatientInfoGrid"></div>
              </section>

              <section class="report-section">
                <h3 id="reportTreatmentInfoTitle">治疗信息</h3>
                <div class="report-grid" id="reportTreatmentInfoGrid"></div>
              </section>

              <section class="report-section" id="reportSectionTips">
                <h3 id="reportTipsTitle">干眼注意事项</h3>
                <ul id="reportTipsList" class="report-list"></ul>
              </section>

              <section class="report-section" id="reportSectionDisclaimer">
                <h3 id="reportDisclaimerTitle">医疗报告说明</h3>
                <div id="reportDisclaimerText" class="report-text"></div>
                <div class="report-sign">
                  <div id="reportDoctorSign">医生签名：________________</div>
                  <div id="reportDoctorDate">日期：________________</div>
                </div>
              </section>
            </div>

            <div id="reportActions" class="report-actions">
              <div class="report-export-options">
                <div class="export-checks">
                  <label><input type="checkbox" id="exportIncludePatient" checked /><span id="exportIncludePatientLabel">患者信息</span></label>
                  <label><input type="checkbox" id="exportIncludeTreatment" checked /><span id="exportIncludeTreatmentLabel">治疗信息</span></label>
                  <label><input type="checkbox" id="exportIncludeTips" checked /><span id="exportIncludeTipsLabel">注意事项</span></label>
                  <label><input type="checkbox" id="exportIncludeDisclaimer" checked /><span id="exportIncludeDisclaimerLabel">报告说明</span></label>
                </div>
                <div class="export-format">
                  <label for="reportExportFormat" id="reportExportFormatLabel">导出格式</label>
                  <select id="reportExportFormat">
                    <option value="pdf">PDF</option>
                    <option value="word">Word</option>
                    <option value="excel">Excel</option>
                  </select>
                </div>
                <div class="export-format">
                  <label for="reportTemplateSelect" id="reportTemplateLabel">报告模板</label>
                  <select id="reportTemplateSelect">
                    <option value="standard">标准</option>
                    <option value="compact">简洁</option>
                  </select>
                </div>
              </div>
              <div class="report-export-actions">
                <button id="btnExportPdf" class="action subtle">导出</button>
                <button id="btnPrintReport" class="action start">打印报告</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="reportArchiveScreen" class="screen report-archive-screen">
        <div class="form-shell report-archive-shell">
          <header class="top-bar">
            <button id="btnBackReportArchive" class="icon-back" aria-label="返回病例列表"><span>←</span></button>
            <div class="section-title" id="reportArchiveTitle">报告列表</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="report-archive-layout">
            <div class="report-archive-list" id="reportArchiveList"></div>
            <iframe class="report-archive-viewer" id="reportArchiveViewer" title="Report PDF"></iframe>
          </div>

          <div class="settings-actions logs-actions">
            <button id="btnRefreshReportArchive" class="ghost-btn" type="button">刷新</button>
            <button id="btnPrintArchiveReport" class="ghost-btn" type="button">打印</button>
            <button id="btnShareReport" class="ghost-btn" type="button">分享</button>
            <button id="btnDeleteReport" class="ghost-btn" type="button">删除</button>
            <button id="btnClearReports" class="ghost-btn" type="button">清空</button>
          </div>
        </div>
      </section>

      <section id="engineerScreen" class="screen engineer-screen">
        <div class="form-shell engineer-shell">
          <header class="top-bar">
            <button id="btnBackEngineer" class="icon-back" aria-label="返回主页"><span>←</span></button>
            <div class="section-title" id="engineerTitle">工程模式</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="engineer-grid">
            <div class="settings-card headered">
              <h3 id="engineerParamsTitle">治疗参数</h3>
              <div class="setting-row">
                <div class="meta">
                  <strong id="engineerPressureLabel">压力</strong>
                </div>
                <div class="pill"><span id="engineerCurrentLabel1">当前</span><strong id="engineerPressureValue">250 mmHg</strong></div>
              </div>
              <input type="range" class="mac-slider" id="engineerPressure" min="0" max="400" step="1" value="250" />

              <div class="setting-row">
                <div class="meta">
                  <strong id="engineerDurationLabel">时间</strong>
                </div>
                <div class="pill"><span id="engineerCurrentLabel2">当前</span><strong id="engineerDurationValue">10 min</strong></div>
              </div>
              <input type="range" class="mac-slider" id="engineerDuration" min="1" max="30" step="1" value="10" />

              <div class="setting-row">
                <div class="meta">
                  <strong id="engineerTempLabel">温度</strong>
                </div>
                <div class="pill"><span id="engineerCurrentLabel3">当前</span><strong id="engineerTempValue">42 ℃</strong></div>
              </div>
              <input type="range" class="mac-slider" id="engineerTemp" min="35" max="45" step="0.1" value="42" />

              <div class="settings-actions">
                <button id="btnEngineerApplyToDevice" class="ghost-btn" type="button">下发到设备</button>
              </div>
            </div>

            <div class="settings-card">
              <h3 id="engineerTestTitle">设备测试</h3>
              <div class="setting-row">
                <div class="meta">
                  <strong id="engineerBrightnessLabel">屏幕亮度</strong>
                </div>
                <div class="pill"><span id="engineerCurrentLabel4">当前</span><strong id="engineerBrightnessValue">80%</strong></div>
              </div>
              <input type="range" class="mac-slider" id="engineerBrightness" min="0" max="100" step="1" value="80" />

              <div class="setting-row">
                <div class="meta">
                  <strong id="engineerVolumeLabel">系统音量</strong>
                </div>
                <div class="pill"><span id="engineerCurrentLabel5">当前</span><strong id="engineerVolumeValue">60%</strong></div>
              </div>
              <input type="range" class="mac-slider" id="engineerVolume" min="0" max="100" step="1" value="60" />

              <div class="settings-actions">
                <button id="btnEngineerTestSound" class="ghost-btn" type="button">测试提示音</button>
                <button id="btnEngineerTestLed" class="ghost-btn" type="button">测试灯带</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="settingsScreen" class="screen settings-screen">
        <div class="settings-container">
          <header class="top-bar">
            <button id="btnBackSettings" class="icon-back" aria-label="返回主页"><span>←</span></button>
            <div class="section-title">系统设置</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="settings-layout">
            <aside class="settings-sidebar">
              <div class="sidebar-title">偏好选项</div>
              <div class="settings-nav">
                <button type="button" data-module="display" class="active">显示 <span class="hint">亮度 / 屏保</span></button>
                <button type="button" data-module="sound">声音 <span class="hint">音量 / 提示</span></button>
                <button type="button" data-module="device">设备 <span class="hint">连接 / 校准</span></button>
                <button type="button" data-module="printer">打印机 <span class="hint">选择 / 设置</span></button>
                <button type="button" data-module="accounts">账户 <span class="hint">添加 / 管理</span></button>
                <button type="button" data-module="language">语言 <span class="hint">中文 / English</span></button>
                <button type="button" data-module="about">关于 <span class="hint">版本 / 更新</span></button>
                <button type="button" data-module="history">操作记录 <span class="hint">撤销 / 恢复</span></button>
                <button type="button" data-module="logs">日志 <span class="hint">查看 / 导出</span></button>
              </div>
            </aside>

              <div class="settings-main">
                <div id="settingsModuleDisplay" class="settings-module active" data-module="display">
                  <div class="settings-card headered">
                    <h3>显示</h3>
                    <div class="setting-row">
                      <div class="meta">
                        <strong>屏幕亮度</strong>
                      </div>
                      <div class="pill"><span>当前</span><strong id="settingsBrightnessValue">80%</strong></div>
                    </div>
                    <input type="range" class="mac-slider" id="settingsBrightness" min="0" max="100" step="1" />
                    <div class="setting-row">
                      <div class="meta">
                        <strong>屏保等待</strong>
                      </div>
                      <div class="pill"><span>倒计时</span><strong id="screensaverValue">10 min</strong></div>
                    </div>
                    <select id="screensaverSelect">
                      <option value="5">5 分钟</option>
                      <option value="10">10 分钟</option>
                      <option value="15">15 分钟</option>
                      <option value="30">30 分钟</option>
                      <option value="60">60 分钟</option>
                    </select>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="themeLabel">界面主题</strong>
                        <span id="themeHint">浅色 / 深色</span>
                      </div>
                      <select id="themeSelect">
                        <option value="dark">深色</option>
                        <option value="light">浅色</option>
                      </select>
                    </div>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="fontScaleLabel">字体大小</strong>
                        <span id="fontScaleHint">调整显示字号</span>
                      </div>
                      <select id="fontScaleSelect">
                        <option value="0.9">小</option>
                        <option value="1">标准</option>
                        <option value="1.1">大</option>
                        <option value="1.2">特大</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleSound" class="settings-module" data-module="sound">
                  <div class="settings-card">
                    <h3>声音</h3>
                    <div class="setting-row">
                      <div class="meta">
                        <strong>系统音量</strong>
                      </div>
                      <div class="pill"><span>当前</span><strong id="settingsVolumeValue">60%</strong></div>
                    </div>
                    <input type="range" class="mac-slider" id="settingsVolume" min="0" max="100" step="1" />
                    <div class="setting-row">
                      <div class="meta">
                        <strong>提示音</strong>
                        <span>重要操作播放提示</span>
                      </div>
                      <label class="toggle">
                        <input type="checkbox" id="chimeToggle" />
                        <span class="toggle-track"></span>
                      </label>
                    </div>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="pressureAlertSoundLabel">压力警示音</strong>
                        <span id="pressureAlertSoundHint">压力超过 250mmHg 时提示</span>
                      </div>
                      <label class="toggle">
                        <input type="checkbox" id="pressureAlertToggle" />
                        <span class="toggle-track"></span>
                      </label>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleDevice" class="settings-module" data-module="device">
                  <div class="settings-card">
                    <h3 id="deviceTitle">设备连接</h3>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="deviceStatusLabel">设备状态</strong>
                        <span id="deviceStatusHint">实时监测连接</span>
                      </div>
                      <div class="pill"><span id="deviceStatusText">未连接</span></div>
                    </div>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="deviceAutoReconnectLabel">自动重连</strong>
                        <span id="deviceAutoReconnectHint">断开后自动尝试连接</span>
                      </div>
                      <label class="toggle">
                        <input type="checkbox" id="deviceAutoReconnect" />
                        <span class="toggle-track"></span>
                      </label>
                    </div>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="deviceCalibrationLabel">校准提醒</strong>
                        <span id="deviceCalibrationHint">定期校准确保压力准确</span>
                      </div>
                      <div class="pill"><span id="deviceCalibrationValue">--</span></div>
                    </div>
                    <div class="settings-actions">
                      <button id="btnDeviceReconnect" class="ghost-btn" type="button">立即重连</button>
                      <button id="btnDeviceCalibrated" class="ghost-btn" type="button">已校准</button>
                    </div>
                  </div>
                </div>

                <div id="settingsModulePrinter" class="settings-module" data-module="printer">
                  <div class="settings-card">
                    <h3 id="printerTitle">打印机</h3>
                    <div class="setting-row">
                      <div class="meta">
                        <strong id="printerSelectLabel">选择打印机</strong>
                        <span id="printerSelectHint">用于打印病例报告</span>
                      </div>
                      <div class="pill"><span id="printerCurrentLabel">当前</span><strong id="printerCurrentName">--</strong></div>
                    </div>
                    <select id="printerSelect"></select>
                    <div class="settings-actions">
                      <button id="btnRefreshPrinters" class="ghost-btn">刷新列表</button>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleAccounts" class="settings-module" data-module="accounts">
                  <div class="settings-card">
                    <h3 id="accountsTitle">账户</h3>
                    <div class="logs-layout accounts-layout">
                      <div class="logs-list" id="accountsList"></div>
                      <div class="accounts-form">
                        <div class="setting-row">
                          <div class="meta">
                            <strong id="accountsAddTitle">添加账户</strong>
                            <span id="accountsAddHint">新账户可用于登录系统</span>
                          </div>
                        </div>
                        <div class="form-row">
                          <label id="accountsUsernameLabel" for="accountUsername">账号</label>
                          <input id="accountUsername" class="osk-input" autocomplete="off" placeholder="username" />
                        </div>
                        <div class="form-row">
                          <label id="accountsPasswordLabel" for="accountPassword">密码</label>
                          <input id="accountPassword" type="password" class="osk-input" autocomplete="off" placeholder="password" />
                        </div>
                        <div class="form-row">
                          <label id="accountsPassword2Label" for="accountPassword2">确认密码</label>
                          <input id="accountPassword2" type="password" class="osk-input" autocomplete="off" placeholder="password" />
                        </div>
                        <div class="form-row">
                          <label id="accountsRoleLabel" for="accountRole">权限等级</label>
                          <select id="accountRole">
                            <option value="operator">普通用户</option>
                            <option value="admin">管理员</option>
                          </select>
                        </div>
                        <div class="settings-actions">
                          <button id="btnAddAccount" class="ghost-btn" type="button">添加</button>
                          <button id="btnLogout" class="ghost-btn" type="button">退出登录</button>
                        </div>
                        <div id="accountsMessage" class="form-msg" hidden></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleLanguage" class="settings-module" data-module="language">
                  <div class="settings-card">
                    <h3>语言</h3>
                    <div class="setting-row">
                      <div class="meta">
                        <strong>界面语言</strong>
                      </div>
                      <div class="pill"><span>当前</span><strong id="languageValue">中文</strong></div>
                    </div>
                    <div class="radio-pill">
                      <label>
                        <input type="radio" name="lang" id="languageZh" value="zh" checked />
                        <span>中文</span>
                      </label>
                      <label>
                        <input type="radio" name="lang" id="languageEn" value="en" />
                        <span>English</span>
                      </label>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleAbout" class="settings-module" data-module="about">
                  <div class="settings-card">
                    <h3>关于</h3>
                    <div class="settings-meta">
                      <div class="meta-tile">
                        <div class="label">程序版本</div>
                        <div class="value" id="settingsAppVersion">0.1.0</div>
                      </div>
                      <div class="meta-tile">
                        <div class="label">固件版本</div>
                        <div class="value" id="settingsFirmwareVersion">--</div>
                      </div>
                    </div>
                    <div class="settings-actions">
                      <button id="btnCheckUpdates" class="ghost-btn">检查更新</button>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleLogs" class="settings-module" data-module="logs">
                  <div class="settings-card">
                    <h3>日志</h3>
                    <div class="logs-layout">
                      <div class="logs-list" id="logsList"></div>
                      <pre class="logs-viewer" id="logContent"></pre>
                    </div>
                    <div class="settings-actions logs-actions">
                      <button id="btnRefreshLogs" class="ghost-btn">刷新</button>
                    </div>
                  </div>
                </div>

                <div id="settingsModuleHistory" class="settings-module" data-module="history">
                  <div class="settings-card">
                    <h3 id="historyTitle">操作记录</h3>
                    <div id="historyList" class="history-list"></div>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </section>


    </div>

    <nav class="bottom-nav" id="bottomNav">
      <button type="button" data-view="quick" class="nav-item">
        <span class="nav-icon nav-icon-treatment"></span>
        <span class="label">治疗</span>
      </button>
      <button type="button" data-view="patientList" class="nav-item">
        <span class="nav-icon nav-icon-patient"></span>
        <span class="label">病例</span>
      </button>
      <button type="button" data-view="reportArchive" class="nav-item">
        <span class="nav-icon nav-icon-report"></span>
        <span class="label">报告</span>
      </button>
      <button type="button" data-view="settings" class="nav-item">
        <span class="nav-icon nav-icon-settings"></span>
        <span class="label">设置</span>
      </button>
    </nav>

    <div id="alertBanner" class="alert" hidden></div>

    <div id="autosaveRestoreModal" class="modal" hidden>
      <div class="modal-body modal-form">
        <div class="modal-title" id="autosaveRestoreTitle">恢复治疗进度</div>
        <div class="modal-body-text" id="autosaveRestoreText">检测到未完成的治疗进度，是否恢复？</div>
        <div class="modal-body-text" id="autosaveRestoreMeta">--</div>
        <div class="modal-actions">
          <button id="btnAutosaveDiscard" class="action subtle" type="button">忽略</button>
          <button id="btnAutosaveRestore" class="action start" type="button">恢复</button>
        </div>
      </div>
    </div>

    <div id="shieldModal" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title">眼盾未就绪</div>
        <p id="shieldModalText">请确认左右眼盾均已插入并保持良好接触。</p>
        <button id="modalClose" class="action start">知道了</button>
      </div>
    </div>

    <div id="shieldLostModal" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title">眼盾断开</div>
        <p>检测到眼盾离线，治疗已停止，请检查佩戴情况并重试。</p>
        <button id="shieldLostBack" class="action start">返回</button>
      </div>
    </div>

    <div id="shieldConfirm" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title" id="shieldConfirmTitle">仅左眼盾在线</div>
        <p id="shieldConfirmText">检测到仅左通道可用，是否继续治疗？</p>
        <div class="modal-actions">
          <button id="confirmCancel" class="action subtle">取消</button>
          <button id="confirmContinue" class="action start">继续</button>
        </div>
      </div>
    </div>

    <div id="exportAfterTreatmentModal" class="modal" hidden>
      <div class="modal-body export-after-modal">
        <div class="modal-title" id="exportAfterTreatmentTitle">治疗完成</div>
        <p id="exportAfterTreatmentText">是否需要导出报告？</p>
        <div class="modal-actions">
          <button id="btnExportAfterNo" class="action subtle">暂不导出</button>
          <button id="btnExportAfterYes" class="action start">导出报告</button>
        </div>
      </div>

      <div id="photoCaptureModal" class="modal" hidden>
        <div class="modal-body photo-modal">
          <div class="modal-title" id="photoModalTitle">拍照</div>
          <video id="photoVideo" autoplay playsinline></video>
          <canvas id="photoCanvas" hidden></canvas>
          <div class="modal-actions">
            <button id="photoCaptureCancel" class="action subtle">取消</button>
            <button id="photoCaptureTake" class="action start">拍照</button>
          </div>
        </div>
      </div>

      <div id="patientDeleteModal" class="modal" hidden>
        <div class="modal-body modal-form">
          <div class="modal-title" id="patientDeleteTitle">确认删除病例</div>
          <div class="modal-body-text" id="patientDeleteText">确认删除所选病例？此操作不可恢复。</div>
          <div class="form-row">
            <label id="patientDeletePasswordLabel" for="patientDeletePassword">确认密码</label>
            <input id="patientDeletePassword" type="password" class="login-input osk-input" autocomplete="off" />
          </div>
          <div id="patientDeleteMessage" class="form-msg" hidden></div>
          <div class="modal-actions">
            <button id="patientDeleteCancel" class="action subtle">取消</button>
            <button id="patientDeleteConfirm" class="action start">确认删除</button>
          </div>
        </div>
      </div>
    </div>

    <div id="loginAddUserModal" class="modal" hidden>
      <div class="modal-body modal-form">
        <div class="modal-title" id="loginAddUserTitle">新增用户</div>
        <div class="modal-body-text" id="loginAddUserHint">仅管理员可新增用户。</div>
        <div class="form-row">
          <label for="loginAddUsername">用户名</label>
          <input id="loginAddUsername" type="text" class="login-input osk-input" autocomplete="off" />
        </div>
        <div class="form-row">
          <label for="loginAddPassword">密码</label>
          <input id="loginAddPassword" type="password" class="login-input osk-input" autocomplete="off" />
        </div>
        <div class="form-row">
          <label for="loginAddPassword2">确认密码</label>
          <input id="loginAddPassword2" type="password" class="login-input osk-input" autocomplete="off" />
        </div>
        <div class="form-row">
          <label for="loginAddRole">权限等级</label>
          <select id="loginAddRole">
            <option value="operator">普通用户</option>
            <option value="admin">管理员</option>
          </select>
        </div>
        <div id="loginAddUserMessage" class="form-msg" hidden></div>
        <div class="modal-actions">
          <button id="loginAddUserCancel" class="action subtle">取消</button>
          <button id="loginAddUserSubmit" class="action start">提交</button>
        </div>
      </div>
    </div>

    <div id="loginResetModal" class="modal" hidden>
      <div class="modal-body modal-form">
        <div class="modal-title" id="loginResetTitle">重置密码</div>
        <div class="modal-body-text" id="loginResetHint">需管理员确认后重置。</div>
        <div class="form-row">
          <label for="resetUsername">用户名</label>
          <input id="resetUsername" type="text" class="login-input osk-input" autocomplete="off" />
        </div>
        <div class="form-row">
          <label for="resetPassword">新密码</label>
          <input id="resetPassword" type="password" class="login-input osk-input" autocomplete="off" />
        </div>
        <div class="form-row">
          <label for="resetPassword2">确认密码</label>
          <input id="resetPassword2" type="password" class="login-input osk-input" autocomplete="off" />
        </div>
        <div id="loginResetMessage" class="form-msg" hidden></div>
        <div class="modal-actions">
          <button id="loginResetCancel" class="action subtle">取消</button>
          <button id="loginResetSubmit" class="action start">确认</button>
        </div>
      </div>
    </div>

    <div id="accountRemoveModal" class="modal" hidden>
      <div class="modal-body modal-form">
        <div class="modal-title" id="accountRemoveTitle">确认删除用户</div>
        <div class="modal-body-text" id="accountRemoveText">删除用户后将无法登录系统。</div>
        <div class="modal-body-text" id="accountRemoveImpact">删除用户仅移除登录权限，不影响病例数据。</div>
        <div class="form-row">
          <label for="accountRemovePassword" id="accountRemovePasswordLabel">确认密码</label>
          <input id="accountRemovePassword" type="password" class="login-input osk-input" autocomplete="off" />
        </div>
        <div id="accountRemoveMessage" class="form-msg" hidden></div>
        <div class="modal-actions">
          <button id="accountRemoveCancel" class="action subtle">取消</button>
          <button id="accountRemoveConfirm" class="action start">确认删除</button>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
  </body>
</html>
